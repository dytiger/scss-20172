<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>选择课程</title>
    <link rel="stylesheet" href="css/bootstrap.css"/>
    <link rel="stylesheet" href="css/jquery-ui.css"/>
    <link rel="stylesheet" href="css/easyui.css"/>
    <link rel="stylesheet" href="css/color.css"/>
    <link rel="stylesheet" href="css/icon.css"/>
</head>
<body>
<div class="container">
    <div class="easyui-tabs">
        <div title="可选课程">
            <div id="select-tool-bar" style="padding:3px">
                <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="">选课</a>
            </div>
            <table id="course-for-select-list"></table>
        </div>
        <div title="可退课程">
            <div id="cancel-tool-bar" style="padding:3px">
                <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="">退课</a>
            </div>
            <table id="course-for-cancel-list"></table>
        </div>
        <div title="已选课程">
            <table id="selected-list"></table>
        </div>
    </div>
</div>

<script src="js/jquery-3.2.1.js"></script>
<script src="js/bootstrap.js"></script>
<script src="js/jquery-ui.js"></script>
<script src="js/jquery.easyui.min.js"></script>
<script src="js/easyui-lang-zh_CN.js"></script>
<script>
    $('#course-for-select-list').datagrid({
        title: "可选课程列表",
        url: '/sc/courseForSelectList',
        method: "GET",
        toolbar: "#select-tool-bar",
        columns: [[
            {field: 'idStr', title: 'ID', checkbox: true, resizable: true},
            {field: 'name', title: '名称', width: 100, resizable: true},
            {field: 'teacher', title: '讲师', width: 50, resizable: true},
            {field: 'serviceTeacher', title: '班主任', width: 50, resizable: true},
            {field: 'serviceTeacherTel', title: '班主任电话', width: 100, resizable: true},
            {field: 'classroom', title: '教室', width: 50, resizable: true},
            {field: 'beginTeachTime', title: '开始上课时间', width: 150, resizable: true},
            {field: 'credit', title: '学分', width: 40, resizable: true},
            {field: 'maxAmount', title: '课容量', width: 40, resizable: true},
            {field: 'currentAmount', title: '已选人数', width: 40, resizable: true},
        ]]
    });

    $('#course-for-cancel-list').datagrid({
        title: "可退课程列表",
        url: '/sc/courseForCancelList',
        method: "GET",
        toolbar: "#cancel-tool-bar",
        columns: [[
            {field: 'idStr', title: 'ID', checkbox: true, resizable: true},
            {field: 'name', title: '名称', width: 100, resizable: true},
            {field: 'teacher', title: '讲师', width: 50, resizable: true},
            {field: 'serviceTeacher', title: '班主任', width: 50, resizable: true},
            {field: 'serviceTeacherTel', title: '班主任电话', width: 100, resizable: true},
            {field: 'classroom', title: '教室', width: 50, resizable: true},
            {field: 'beginTeachTime', title: '开始上课时间', width: 150, resizable: true},
            {field: 'credit', title: '学分', width: 40, resizable: true},
            {field: 'maxAmount', title: '课容量', width: 40, resizable: true},
            {field: 'currentAmount', title: '已选人数', width: 40, resizable: true},
        ]]
    });

    $('#selected-list').datagrid({
        title: "已选课程列表",
        url: '/sc/selectedCourse',
        method: "GET",
        columns: [[
            {field: 'name', title: '名称', width: 100, resizable: true},
            {field: 'teacher', title: '讲师', width: 50, resizable: true},
            {field: 'serviceTeacher', title: '班主任', width: 50, resizable: true},
            {field: 'serviceTeacherTel', title: '班主任电话', width: 100, resizable: true},
            {field: 'classroom', title: '教室', width: 50, resizable: true},
            {field: 'beginTeachTime', title: '开始上课时间', width: 150, resizable: true},
            {field: 'credit', title: '学分', width: 40, resizable: true},
            {field: 'maxAmount', title: '课容量', width: 40, resizable: true},
            {field: 'currentAmount', title: '已选人数', width: 40, resizable: true},
        ]]
    });

    function doSearch() {
        $('#course-list').datagrid('load', {
            "name": $("#name").val(),
            "status": $("#status").val(),
            "begin": $("#begin").val(),
            "end": $("#end").val()
        });
    }

    function openSaveDialog() {
        $('#save-dialog').dialog({
            title: "添加新课程",
            width: 350,
            height: 400,
            closed: false,
            cache: false,
            modal: true,
            buttons: "#save-buttons"
        });
        $("#save-dialog").dialog('open');
    }

    function save() {
        let course = {
            "name": $("#save-name").val(),
            "teacher": $("#save-teacher").val(),
            "serviceTeacher": $("#save-service-teacher").val(),
            "serviceTeacherTel": $("#save-service-teacher-tel").val(),
            "classroom": $("#save-classroom").val(),
            "beginTeachTime": $("#save-begin-teach-time").val().replace("T", " "),
            "endTeachTime": $("#save-end-teach-time").val().replace("T", " "),
            "beginSelectTime": $("#save-begin-select-time").val().replace("T", " "),
            "endSelectTime": $("#save-end-select-time").val().replace("T", " "),
            "credit": $("#save-credit").val(),
            "maxAmount": $("#save-max-amount").val()
        };

        $.ajax({
            url: "/course",
            type: "POST",
            data: JSON.stringify(course),
            dataType: "json",
            contentType: "application/json"
        }).then(function (message) {
            alert(message.messageText);
            $("#save-form").get(0).reset();
            $("#course-list").datagrid('reload');
            $("#save-dialog").dialog('close');
        }, function (xhr) {
            alert(xhr.responseText);
        });
    }

    function openUpdateDialog() {
        let course = $("#course-list").datagrid('getSelected');

        console.log(JSON.stringify(course));

        $("#update-id").val(course.idStr);
        $("#update-name").val(course.name);
        $("#update-teacher").val(course.teacher);
        $("#update-service-teacher").val(course.serviceTeacher);
        $("#update-service-teacher-tel").val(course.serviceTeacherTel);
        $("#update-classroom").val(course.classroom);
        $("#update-begin-teach-time").val(course.beginTeachTime.replace(" ", "T"));
        $("#update-end-teach-time").val(course.endTeachTime.replace(" ", "T"));
        $("#update-begin-select-time").val(course.beginSelectTime.replace(" ", "T"));
        $("#update-end-select-time").val(course.endSelectTime.replace(" ", "T"));
        $("#update-credit").val(course.credit);
        $("#update-max-amount").val(course.maxAmount);
        $("#update-status").val(course.status);

        $('#update-dialog').dialog({
            title: "修改课程信息",
            width: 350,
            height: 400,
            closed: false,
            cache: false,
            modal: true,
            buttons: "#update-buttons"
        });
        $("#update-dialog").dialog('open');
    }

    function update() {
        let course = {
            "id": $("#update-id").val(),
            "name": $("#update-name").val(),
            "teacher": $("#update-teacher").val(),
            "serviceTeacher": $("#update-service-teacher").val(),
            "serviceTeacherTel": $("#update-service-teacher-tel").val(),
            "classroom": $("#update-classroom").val(),
            "beginTeachTime": $("#update-begin-teach-time").val().replace("T", " "),
            "endTeachTime": $("#update-end-teach-time").val().replace("T", " "),
            "beginSelectTime": $("#update-begin-select-time").val().replace("T", " "),
            "endSelectTime": $("#update-end-select-time").val().replace("T", " "),
            "credit": $("#update-credit").val(),
            "maxAmount": $("#update-max-amount").val(),
            "status": $("#update-status").val()
        };

        console.log(JSON.stringify(course));

        $.ajax({
            url: "/course",
            type: "PUT",
            data: JSON.stringify(course),
            dataType: "json",
            contentType: "application/json"
        }).then(function (message) {
            alert(message.messageText);
            // 更新成功后，调用数据网格组件的重新加载数据方法
            $("#course-list").datagrid('reload');
            $("#update-dialog").dialog('close');
        }, function (xhr) {
            alert(xhr.responseText);
        });
    }
</script>
</body>
</html>